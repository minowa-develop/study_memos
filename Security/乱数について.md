# 乱数について

## 乱数の種類

特徴|生成方法|決定性|再現性|使用用途
-|-|-|-|-
擬似乱数(PRNG)|数学的アルゴリズム|決定的|高|シミュレーション、ゲーム、統計解析など
真正乱数(TRNG)|物理的現象(熱や電子ノイズなど)|非決定的|低|セキュリティ、暗号化など
量子乱数(QRNG)|量子力学の原理(不確定性原理)|非決定的|低|暗号化、高度なセキュリティ、研究など

※ QRNGはTRNGの一種

### 決定性と再現性の違い

名称|desc
-|-
決定性|同じ入力から同じ出力が得られる特性、システムの内部の動作に関する
再現性|同じ条件や手順で同じ結果が得られる特性、外部の条件や手順に関する

## 性質

性質|timing|desc
-|-|-
無作為性|生成段階|出来事が完全にランダムで、予測やパターンが存在しない状態
予想不可能性|生成前|次に何が起こるかを予測できない性質
再現不可能性|生成後から再生成前|同じ条件下で同じ結果を再現できない性質

- 無作為性が高い場合、通常は予想不可能性も高くなる
- 無作為性が高くても再現不可能性が高くならないこともある、PRNGが該当する

種別|無作為性|予想不可能性|再現不可能性
-|-|-|-
TRNG|very high|high(※)|high(※)
PRNG|low|low|low

※ シードに依存

## Linuxカーネルの乱数について

以下の説明はrandomとurandomを区別している時代のもの、現在ではuramdomはrandomに統合されている

path|種別|desc
-|-|-
/dev/random|TRNG|ハードウェアから収集した環境ノイズを利用
/dev/urandom|PRNG|エントロピープールから供給される乱数を利用

## Linuxカーネルの乱数生成過程

1. 環境ノイズの収集
   ハードウェアから発生するさまざまな環境ノイズを収集
   例: CPUの熱雑音やマウスの動き、キーボードの入力など

1. エントロピープールへの格納
   収集されたノイズはエントロピープールに格納
   このプールは、システムが乱数生成の際に利用できるランダム性の「貯蔵庫」となる。

1. 乱数生成
   /dev/randomや/dev/urandomから乱数を生成する際に、エントロピープールに蓄えられたランダム性を基にして乱数を生成
   /dev/randomは十分なエントロピーが得られるまでブロックするのに対し、/dev/urandomはより高速に乱数(PRNG)を提供する

※ エントロピープールからエントロピーを取り込む(取得)と取得するとその分だけエントロピープールから消費される。要はPOPみたいなイメージ

エントロピープール状態|path|結果
-|-|-
十分|random|取得したエントロピーを乱数として利用(TRNG)
十分|urandom|取得したエントロピーをシードとして乱数生成(PRNG)
枯渇|random|Blocking
枯渇|urandom|取得したエントロピーをシードとして乱数生成し、擬似乱数生成アルゴリズムを使用（PRNG）
